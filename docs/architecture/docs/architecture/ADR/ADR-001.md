ADR-001: Сховище даних

Статус: [Запропоновано / Прийнято / Відхилено]
Дата: 01.10.2025

Контекст:
Дані: фільми, персони (актори/режисери), користувачі, рецензії, оцінки, лайки, підписки, жанри, watchlist.
Вимоги: швидкий пошук за назвою/жанром/персоною (PERF-002), сторінки з рецензіями <2с у 95% (PERF-001), висока доступність (REL-001), відновлення без втрат (REL-002).
Очікувані обсяги: [X сот. фільмів], [Y сот. користувачів], [Z рецензій/день].
Обмеження: [обрана мова/фреймворк], [хмара/он-прем], [бюджет/команда].

Рішення: 
Використати PostgreSQL як основну реляційну БД з нормалізованою схемою:

Таблиці: film, person, film_person, user, review, rating, like, follow, watchlist, genre, film_genre.

Ключові індекси: film.title, person.name, зв’язки Many-to-Many; часткові індекси для активних/видимих рецензій.

Пошук винести в окремий рушій [Meilisearch/Elasticsearch] з інкрементальною індексацією з БД (тобто після кожної зміни в БД (новий фільм, оновлена рецензія) подія надсилається в пошуковий рушій, і він оновлює тільки відповідний документ, а не перебудовує весь індекс).

Наслідки:
+ Транзакційна цілісність і складні запити (рекомендації/статистика)
+ Масштабований пошук і фільтри виконують PERF-002
- Операційні витрати на дві системи (БД + пошук)
- Вікна несинхронності між БД і індексом


Розглянуті альтернативи:
* Лише PostgreSQL FTS — простіше, але гірша релевантність і складні фасети/сортування на масштабі.

* Документна БД (MongoDB) + пошук — простіші записи рецензій, але складні агрегації/зв’язки.

* Зовнішній каталог (TMDb) без локального зберігання — менші витрати, але залежність і обмеження ліцензій/latency.
