# Code Review Report — rate-ukma
**Ревʼюер:** team kod_pisat_pushit_dyploit  
**Репозиторій:** [ukma-cs-ssdm-2025/rate-ukma](https://github.com/ukma-cs-ssdm-2025/rate-ukma)  
**Сфера:** Повний огляд продуктивності — Django API, база PostgreSQL, фронтенд на React, CI/CD у Docker.  
**Методологія:** Аналіз архітектури -> профілювання запитів і виконання -> аналіз білду/бандлу -> рекомендації щодо продуктивності.


---


## 1. Підсумок
**Загальна якість:** міцна інженерна база з гарною CI/CD-грамотністю; є суттєвий потенціал покращення запитів, кешування й швидкодії фронтенду.


| Область | Стан продуктивності | Пріоритет |
|----------|--------------------|------------|
| Backend (Django/DRF) | Чітка структура, але N+1 запити та відсутність кешу для агрегатів |  Високий |
| Database (PostgreSQL) | Відсутні індекси на частих фільтрах і сортах |  Високий |
| Frontend (React) | Монолітний бандл і дублювання запитів |  Середній |
| Інфраструктура / CI | Добра автоматизація, але без перф-гейтів |  Середній |


**Швидкі покращення**
- Використати `select_related` / `prefetch_related` у гарячих ендпоінтах.  
- Додати Redis кеш (page + low-level).  
- Створити BTREE + GIN (trgm) індекси для частих фільтрів.  
- Інтегрувати Lighthouse CI та bundle analyzer.  
- Використати `React.lazy` + SWR для клієнтського кешу.




## 2. Контекст проєкту
- **Технології:** Django + DRF API · React SPA · PostgreSQL  
- **Середовища:**  
  - https://staging.rateukma.com  
  - https://rateukma.com  
- **Docker:** Compose-профіль `dev`, приклад `.env` усередині `src/`.




## 3. Backend (Django / DRF)
### Знахідки
- Можливі N+1 запити у списках курсів і ревʼю.  
- Важкі агрегати (`avg_rating`, `count`) перераховуються на кожен запит.  
- Пагінація не застосовується глобально.  
- Відсутній кеш на рівні API.


### Рекомендації
- Увімкнути глобальну пагінацію.
- Матеріалізувати агрегати через Celery або періодичні таски.
- Увімкнути gzip/brotli на проксі; уникати надлишкової вкладеності JSON.


## 4. Database (PostgreSQL)
### Знахідки
- Часті фільтри (department, professor, rating, semester) викликають seq scans.
- Пошук без trigram-індекса.
- Сортування за обчислюваним avg_rating є дорогим.
### Рекомендації
- Матеріалізовані view для топових або трендових вибірок.
- Налаштувати VACUUM/ANALYZE частіше.


## 5. API Contract (OpenAPI)
- Обов’язково впровадити пагінацію та параметр ?fields= для вибіркових полів.
- Додати ETag/Last-Modified для умовного GET.
- Документувати rate limits, щоб уникнути перевантаження сервера.


## 6. Frontend (React)
### Знахідки
- Монолітний бандл; аналітичні графіки завантажуються одразу.
- Немає кешу на клієнті → повторні запити.
- Довгі списки не віртуалізовані.
### Рекомендації
- Додати SWR/TanStack Query (stale-while-revalidate).
- Віртуалізувати списки (react-window).
- Встановити довготривале кешування статичних активів.


## 7. Інфраструктура / Runtime
- Оптимізувати Gunicorn/Uvicorn (2 × CPU + 1, таймаути 30 с).
- Використати Redis для кешу, throttle і черг.
- Увімкнути gzip та brotli в NGINX.
- Підключити CDN або WhiteNoise для статики.


## 8. Тестування / CI
- Додати Lighthouse CI (бюджети LCP, TTI, TBT).
- Інтегрувати pytest-benchmark для гарячих ендпоінтів.
- Увімкнути django-silk або debug-toolbar на staging.
- Виконувати pip audit і npm audit у CI.


## 9. Developer Experience
- Додати перф-чеклист у PR-шаблон (пагінація, індекси, кеш).
- Розширити pre-commit з ruff та eslint правилами для продуктивності.










